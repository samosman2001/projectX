<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Main Page</title>
 <link rel="stylesheet" type="text/css" href="../styles/mainApp.css">
  <link rel="stylesheet" type="text/css" href="../../frontend/styles/login.css">
  </style>
</head>
<body>

  <header>
    <img src="your-logo.png" alt="Logo" class="logo" />
    <div class="logout"><img src="../../frontend/assets/icons/exitApp.svg"></div>
  </header>

  <main>
    <!-- Content goes here -->
  </main>

 <nav class="bottom-nav">
    <div class="item">
      <a href="nutritionApp.html">
      <div class="icon">ğŸ</div>
      <div>Nutrition</div>
    </a>
    </div>
    <div class="item">
      <a href="exerciseApp.html">
      <div class="icon">ğŸ‹ï¸</div>
      <div>Exercise</div>
     </a>
    </div>

       <div class="home-button">
 <a href="mainApp.html">
    ğŸ 
  </a></div>

    <div class="item">
      <div class="icon">ğŸ—“ï¸</div>
      <div>Calendar</div>
    </div>
    <div class="item">
      <div class="icon">ğŸ“ˆ</div>
      <div>Progress</div>
    </div>
  </nav>
<div class="toast fail"></div>
<div class="toast success"></div>
<script>
  const exitButton = document.querySelector(".logout");
  exitButton.addEventListener("click",()=>
  {
 window.location.href = "../../backend/auth/logout.php?platform=app";
  })
function showToast(message) {
  let toast;
  if(message.toLowerCase().includes("successfully"))
  toast = document.querySelector(".toast.success");
  else
  toast = document.querySelector(".toast.fail");
  
  toast.textContent = message;
  toast.classList.add("show");

  // Hide after 3s
  setTimeout(() => {
    toast.classList.remove("show");
  }, 3000);
}

async function api (path,opts={})
{
  try{
const res = await fetch( path,
{credentials: "include",...opts});
console.log(res);
const text = await res.text(); // â† read raw output
  console.log("RAW:", text);  
  const data  =JSON.parse(text);

  //return data inside the try scope if not then return null
return data;
}
catch(err)
{
  console.log(err.message);
}
return null;
}
async function callToastMessage()
{const data = await api('../api/getToastMessage.php', {
  credentials :'include' 

});
if(data.message)
showToast(data.message);
};



window.addEventListener("pageshow", async () => {
  const data = await api("../api/checkSession.php");
  console.log(data.authenticated);
  if (data.authenticated === false) {
    
    console.log("No Permission. Redirecting...");
    callToastMessage();
      setTimeout(()=>
    {
      window.location.href = data.redirect;
    },1000);


  } 

});
</script>
</body>
</html>
